<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="referrer" content="no-referrer-when-downgrade" />
  <title>Adaa CMS Admin</title>
  <base href="/admin/" />
</head>
<body>
  <script>
    (function() {
      console.log('[Decap OAuth] Initializing...');

      // Clear any stale OAuth messages from previous attempts
      try {
        const oldMessage = localStorage.getItem('decap_oauth_message');
        if (oldMessage) {
          console.log('[Decap OAuth] Clearing stale message from localStorage');
          localStorage.removeItem('decap_oauth_message');
        }
      } catch (e) {
        console.warn('[Decap OAuth] Could not clear localStorage:', e);
      }

      // Add debug listener to see if Decap CMS receives postMessage
      window.addEventListener('message', function(event) {
        if (event.data && typeof event.data === 'string') {
          if (event.data.includes('authorization:github')) {
            console.log('[Decap OAuth] âœ… Received OAuth message from popup!');
            console.log('[Decap OAuth] Message:', event.data.substring(0, 150) + '...');
            console.log('[Decap OAuth] Origin:', event.origin);
            console.log('[Decap OAuth] Source:', event.source ? 'popup window' : 'unknown');
          }
        }
      }, true); // Use capture phase to log before Decap CMS processes

      console.log('[Decap OAuth] Ready - waiting for OAuth messages');
    })();
  </script>
  <script src="https://unpkg.com/decap-cms@^3.0.0/dist/decap-cms.js"></script>
</body>
</html>
